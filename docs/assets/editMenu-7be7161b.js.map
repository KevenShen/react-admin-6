{"version":3,"file":"editMenu-7be7161b.js","sources":["../../src/views/User/Pos/editMenu.tsx"],"sourcesContent":["import { Form, Modal, Tree } from 'antd'\nimport {\n  Key,\n  SetStateAction,\n  forwardRef,\n  memo,\n  useEffect,\n  useImperativeHandle,\n  useState\n} from 'react'\nimport { getMenu, getMenuById } from '@/api/login'\nimport { posEditMenu } from '@/api/menu'\nconst EditMenu = (props, ref) => {\n  const [form] = Form.useForm()\n  const [open, setOpen] = useState(false)\n  const [id, setId] = useState()\n  const [halfCheckedKeys, setHalfCheckedKeys] = useState([])\n  const [treeData, settreeData] = useState([])\n  const [checkedKeys, setCheckedKeys] = useState<React.Key[]>([])\n  const [confirmLoading, setConfirmLoading] = useState(false)\n  useImperativeHandle(ref, () => ({\n    // changeVal 就是暴露给父组件的方法\n    showModal: (id) => {\n      setId(id)\n      getMenuId(id)\n      setOpen(true)\n    }\n  }))\n  const getmenyList = async () => {\n    const { data } = await getMenu()\n    settreeData(data)\n  }\n  // 根据岗位id获取菜单\n  const getMenuId = async (id) => {\n    const { data: menu } = await getMenuById(id)\n    const menuIds: any[] | ((prevState: Key[]) => Key[]) = []\n    menu.forEach((item) => {\n      if (item.children) return menuIds.push(...item.children.map((child) => child.id))\n      menuIds.push(item.id)\n    })\n    setCheckedKeys(menuIds)\n  }\n\n  // 挂载时运行一次 获取所有菜单\n  useEffect(() => {\n    getmenyList()\n  }, [])\n\n  // 更新权限菜单\n  const handleOk = async () => {\n    const { data } = await posEditMenu({\n      menu: [...checkedKeys, ...halfCheckedKeys],\n      id\n    })\n    setOpen(false)\n  }\n  // 弹窗关闭\n  const handleCancel = () => {\n    setOpen(false)\n    setCheckedKeys([])\n  }\n  const onCheck = (arr: SetStateAction<Key[]>, e: { halfCheckedKeys: [] }) => {\n    setHalfCheckedKeys(e.halfCheckedKeys)\n    setCheckedKeys(arr)\n  }\n\n  return (\n    <Modal\n      title=\"编辑\"\n      open={open}\n      onOk={handleOk}\n      getContainer={false}\n      confirmLoading={confirmLoading}\n      destroyOnClose\n      onCancel={handleCancel}>\n      <Tree\n        checkable\n        blockNode\n        fieldNames={{ title: 'name', key: 'id' }}\n        onCheck={onCheck}\n        defaultExpandAll\n        checkedKeys={checkedKeys}\n        treeData={treeData}\n      />\n    </Modal>\n  )\n}\n\nexport default forwardRef(EditMenu) // 必须使用forwardRef包裹组件才能暴露方法\n"],"names":["EditMenu","props","ref","Form","open","setOpen","useState","id","setId","halfCheckedKeys","setHalfCheckedKeys","treeData","settreeData","checkedKeys","setCheckedKeys","confirmLoading","setConfirmLoading","useImperativeHandle","getMenuId","getmenyList","data","getMenu","menu","getMenuById","menuIds","item","child","useEffect","jsx","Modal","posEditMenu","Tree","arr","e","forwardRef"],"mappings":"8JAYA,MAAMA,EAAW,CAACC,EAAOC,IAAQ,CAChBC,EAAK,QAAQ,EAC5B,KAAM,CAACC,EAAMC,CAAO,EAAIC,WAAS,EAAK,EAChC,CAACC,EAAIC,CAAK,EAAIF,EAAS,SAAA,EACvB,CAACG,EAAiBC,CAAkB,EAAIJ,EAAA,SAAS,CAAE,CAAA,EACnD,CAACK,EAAUC,CAAW,EAAIN,EAAA,SAAS,CAAE,CAAA,EACrC,CAACO,EAAaC,CAAc,EAAIR,EAAA,SAAsB,CAAE,CAAA,EACxD,CAACS,EAAgBC,CAAiB,EAAIV,WAAS,EAAK,EAC1DW,EAAA,oBAAoBf,EAAK,KAAO,CAE9B,UAAYK,GAAO,CACjBC,EAAMD,CAAE,EACRW,EAAUX,CAAE,EACZF,EAAQ,EAAI,CACd,CACA,EAAA,EACF,MAAMc,EAAc,SAAY,CAC9B,KAAM,CAAE,KAAAC,CAAA,EAAS,MAAMC,IACvBT,EAAYQ,CAAI,CAAA,EAGZF,EAAY,MAAOX,GAAO,CAC9B,KAAM,CAAE,KAAMe,CAAA,EAAS,MAAMC,EAAYhB,CAAE,EACrCiB,EAAiD,CAAA,EAClDF,EAAA,QAASG,GAAS,CACrB,GAAIA,EAAK,SAAiB,OAAAD,EAAQ,KAAK,GAAGC,EAAK,SAAS,IAAKC,GAAUA,EAAM,EAAE,CAAC,EACxEF,EAAA,KAAKC,EAAK,EAAE,CAAA,CACrB,EACDX,EAAeU,CAAO,CAAA,EAIxBG,OAAAA,EAAAA,UAAU,IAAM,CACFR,GACd,EAAG,CAAE,CAAA,EAqBHS,EAACC,EAAA,CACC,MAAM,KACN,KAAAzB,EACA,KArBa,SAAY,CACV,MAAM0B,EAAY,CACjC,KAAM,CAAC,GAAGjB,EAAa,GAAGJ,CAAe,EACzC,GAAAF,CAAA,CACD,EACDF,EAAQ,EAAK,CAAA,EAiBX,aAAc,GACd,eAAAU,EACA,eAAc,GACd,SAjBiB,IAAM,CACzBV,EAAQ,EAAK,EACbS,EAAe,CAAE,CAAA,CAAA,EAgBf,SAAAc,EAACG,EAAA,CACC,UAAS,GACT,UAAS,GACT,WAAY,CAAE,MAAO,OAAQ,IAAK,IAAK,EACvC,QAlBU,CAACC,EAA4BC,IAA+B,CAC1EvB,EAAmBuB,EAAE,eAAe,EACpCnB,EAAekB,CAAG,CAAA,EAiBd,iBAAgB,GAChB,YAAAnB,EACA,SAAAF,CAAA,CACF,CAAA,CAAA,CAGN,EAEeuB,EAAAA,EAAAA,WAAWlC,CAAQ"}